<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitzgerald HR Assistant - Beta Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Document Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Crisis Mode Pulse Animation */
    </style>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse { animation: pulse 2s ease-in-out infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen">
    
    <!-- Access Code Screen -->
    <div id="accessScreen" class="min-h-screen flex items-center justify-center p-6">
        <div class="max-w-md w-full fade-in">
            <!-- Logo/Branding -->
            <div class="text-center mb-8">
                <div class="inline-block bg-gradient-to-r from-amber-500 to-orange-600 p-1 rounded-2xl mb-4">
                    <div class="bg-slate-900 px-8 py-4 rounded-xl">
                        <h1 class="text-3xl font-bold text-amber-500">FITZGERALD HR</h1>
                        <p class="text-slate-400 text-sm mt-1">AI-Powered Hospitality HR</p>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Beta Testing Programme</h2>
                <p class="text-slate-400">Thank you for helping us test Australia's first AI-powered hospitality HR assistant</p>
            </div>

            <!-- Access Code Form -->
            <div class="bg-slate-800 rounded-2xl p-8 shadow-2xl border border-slate-700">
                <label class="block text-slate-300 font-medium mb-3">Enter Your Access Code</label>
                <input 
                    type="text" 
                    id="accessCodeInput"
                    placeholder="e.g., BETA-VENUE-001"
                    class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-amber-500 focus:ring-2 focus:ring-amber-500/20 transition-all"
                    onkeypress="if(event.key==='Enter') checkAccess()"
                />
                <button 
                    onclick="checkAccess()"
                    class="w-full mt-4 bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-slate-900 font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-105"
                >
                    Access Beta
                </button>
                <p id="accessError" class="text-red-400 text-sm mt-3 hidden"></p>
                
                <div class="mt-6 pt-6 border-t border-slate-700">
                    <p class="text-slate-500 text-xs text-center">
                        Don't have an access code? Contact us at<br/>
                        <a href="mailto:beta@fitzgeraldhr.com.au" class="text-amber-500 hover:underline">beta@fitzgeraldhr.com.au</a>
                    </p>
                </div>
            </div>

            <!-- Info Cards -->
            <div class="mt-8 grid grid-cols-3 gap-4">
                <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-center">
                    <div class="text-2xl mb-2">ü§ñ</div>
                    <p class="text-slate-400 text-xs">AI-Powered Guidance</p>
                </div>
                <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-center">
                    <div class="text-2xl mb-2">üá¶üá∫</div>
                    <p class="text-slate-400 text-xs">Australian Hospitality</p>
                </div>
                <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-center">
                    <div class="text-2xl mb-2">‚ö°</div>
                    <p class="text-slate-400 text-xs">24/7 Available</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Assistant Screen (Hidden Initially) -->
    <div id="assistantScreen" class="hidden min-h-screen flex flex-col">
        <!-- Header -->
        <div class="bg-slate-800/80 backdrop-blur-sm border-b border-slate-700 px-6 py-4">
            <div class="max-w-5xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center">
                        <span class="text-xl">üè®</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Fitz - Your HR Assistant</h1>
                        <p class="text-xs text-slate-400">Beta Testing - <span id="userCode"></span></p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Crisis Mode Button -->
                    <button onclick="activateCrisisMode()" 
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-all flex items-center gap-2">
                        <span class="text-xl">üö®</span>
                        <span>URGENT</span>
                    </button>
                    
                    <!-- Voice Input Button -->
                    <button onclick="toggleVoiceInput()" 
                            id="voiceButton"
                            class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                        <span id="voiceIcon">üé§</span>
                    </button>
                    
                    <!-- Tools Menu -->
                    <div class="relative">
                        <button onclick="toggleToolsMenu()" 
                                class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                            <span>üõ†Ô∏è</span>
                        </button>
                        <div id="toolsMenu" class="hidden absolute right-0 top-12 bg-slate-800 border border-slate-700 rounded-lg shadow-xl w-64 z-50">
                            <div class="p-2">
                                <button onclick="openTool('awardCalculator')" class="w-full text-left px-4 py-3 hover:bg-slate-700 rounded-lg text-slate-200 flex items-center gap-3">
                                    <span>üí∞</span>
                                    <span>Award Calculator</span>
                                </button>
                                <button onclick="openTool('rosterOptimizer')" class="w-full text-left px-4 py-3 hover:bg-slate-700 rounded-lg text-slate-200 flex items-center gap-3">
                                    <span>üìÖ</span>
                                    <span>Roster Optimiser</span>
                                </button>
                                <button onclick="openTool('terminationRisk')" class="w-full text-left px-4 py-3 hover:bg-slate-700 rounded-lg text-slate-200 flex items-center gap-3">
                                    <span>‚öñÔ∏è</span>
                                    <span>Termination Risk</span>
                                </button>
                                <button onclick="openTool('scenarioAnalysis')" class="w-full text-left px-4 py-3 hover:bg-slate-700 rounded-lg text-slate-200 flex items-center gap-3">
                                    <span>üéØ</span>
                                    <span>Scenario Analysis</span>
                                </button>
                                <button onclick="openTool('xeroIntegration')" class="w-full text-left px-4 py-3 hover:bg-slate-700 rounded-lg text-slate-200 flex items-center gap-3">
                                    <span>üîó</span>
                                    <span>Xero Integration</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="showFeedback()" class="text-amber-500 hover:text-amber-400 text-sm font-medium transition-colors">
                        Give Feedback
                    </button>
                    <button onclick="logout()" class="text-slate-400 hover:text-white text-sm transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>

        <!-- Beta Notice -->
        <div class="bg-amber-500/10 border-b border-amber-500/20 px-6 py-3">
            <div class="max-w-5xl mx-auto flex items-center gap-3">
                <span class="text-lg">‚ö†Ô∏è</span>
                <p class="text-amber-200 text-sm">
                    <strong>Beta Test:</strong> This is a preview. Please share honest feedback on your experience!
                </p>
            </div>
        </div>

        <!-- Messages Container -->
        <div id="messagesContainer" class="flex-1 overflow-y-auto px-6 py-6">
            <div class="max-w-5xl mx-auto space-y-6">
                <!-- Welcome Message -->
                <div class="flex justify-start">
                    <div class="max-w-3xl bg-slate-800 border border-slate-700 rounded-2xl px-6 py-4">
                        <p class="text-slate-100 leading-relaxed">G'day! I'm Fitz, your AI assistant from Fitzgerald HR, specialised in hospitality HR for Australian venues.</p>

<p class="text-slate-100 leading-relaxed mt-3">I can help you with Fair Work compliance, award interpretation, employee relations, recruitment advice, and more.</p>

<p class="text-amber-400 font-semibold mt-4 mb-2">üõ†Ô∏è Tools Available:</p>
<p class="text-slate-100 text-sm">Click the tools icon (üõ†Ô∏è) in the top right to access:</p>
<ul class="text-slate-100 text-sm ml-4 mt-1 space-y-1">
    <li>‚Ä¢ Award Calculator</li>
    <li>‚Ä¢ Roster Optimiser</li>
    <li>‚Ä¢ Termination Risk Assessor</li>
    <li>‚Ä¢ Scenario Analysis</li>
    <li>‚Ä¢ Xero Integration</li>
</ul>

<p class="text-red-400 font-semibold mt-4 mb-2">üö® Urgent/Critical Situations:</p>
<p class="text-slate-100 text-sm">Use the red URGENT button for immediate crisis response.</p>

<p class="text-slate-100 leading-relaxed mt-4">What HR challenge can I help you with today?</p>

<p class="text-slate-300 text-sm mt-4">‚úâÔ∏è For personalised support, contact our Senior Consultants at <a href="mailto:info@fitzgeraldhr.com.au" class="text-amber-400 hover:underline">info@fitzgeraldhr.com.au</a></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="bg-slate-800/30 border-t border-slate-700/50 px-6 py-3">
            <div class="max-w-5xl mx-auto">
                <div class="flex items-start gap-2 text-xs text-slate-400 mb-2">
                    <span class="text-amber-500">‚ö†Ô∏è</span>
                    <p>This AI assistant provides general guidance only. For complex matters or legal advice, consult with a Fitzgerald HR Senior Consultant.</p>
                </div>
                <div class="text-center">
                    <p class="text-sm text-slate-300">
                        <span class="text-amber-500 font-semibold">Contact us:</span> info@fitzgeraldhr.com.au
                    </p>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="bg-slate-800/80 backdrop-blur-sm border-t border-slate-700 px-6 py-4">
            <div class="max-w-5xl mx-auto flex gap-3">
                <textarea
                    id="messageInput"
                    placeholder="Ask me anything about hospitality HR in Australia..."
                    class="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:border-amber-500 resize-none"
                    rows="2"
                    onkeypress="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"
                ></textarea>
                <button
                    onclick="sendMessage()"
                    id="sendButton"
                    class="px-6 py-3 bg-amber-500 hover:bg-amber-600 disabled:bg-slate-700 disabled:cursor-not-allowed text-slate-900 font-medium rounded-lg transition-colors flex items-center gap-2"
                >
                    <span>Send</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-2xl w-full border border-slate-700 fade-in">
            <h2 class="text-2xl font-bold text-white mb-4">Beta Feedback</h2>
            <p class="text-slate-400 mb-6">Your feedback helps us build the best AI assistant for hospitality HR. Thank you!</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-slate-300 font-medium mb-2">How would you rate the AI's responses?</label>
                    <div class="flex gap-2">
                        <button onclick="setRating(1)" class="rating-btn px-4 py-2 bg-slate-700 hover:bg-amber-500 text-white rounded-lg transition-all">1 ‚≠ê</button>
                        <button onclick="setRating(2)" class="rating-btn px-4 py-2 bg-slate-700 hover:bg-amber-500 text-white rounded-lg transition-all">2 ‚≠ê</button>
                        <button onclick="setRating(3)" class="rating-btn px-4 py-2 bg-slate-700 hover:bg-amber-500 text-white rounded-lg transition-all">3 ‚≠ê</button>
                        <button onclick="setRating(4)" class="rating-btn px-4 py-2 bg-slate-700 hover:bg-amber-500 text-white rounded-lg transition-all">4 ‚≠ê</button>
                        <button onclick="setRating(5)" class="rating-btn px-4 py-2 bg-slate-700 hover:bg-amber-500 text-white rounded-lg transition-all">5 ‚≠ê</button>
                    </div>
                </div>

                <div>
                    <label class="block text-slate-300 font-medium mb-2">What did you like?</label>
                    <textarea id="feedbackLikes" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:border-amber-500" rows="3" placeholder="What worked well for you?"></textarea>
                </div>

                <div>
                    <label class="block text-slate-300 font-medium mb-2">What could be improved?</label>
                    <textarea id="feedbackImprove" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:border-amber-500" rows="3" placeholder="What would make this better?"></textarea>
                </div>

                <div>
                    <label class="block text-slate-300 font-medium mb-2">Would you pay $79/month for this service?</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 text-slate-300">
                            <input type="radio" name="willPay" value="yes" class="text-amber-500">
                            <span>Yes, definitely</span>
                        </label>
                        <label class="flex items-center gap-2 text-slate-300">
                            <input type="radio" name="willPay" value="maybe" class="text-amber-500">
                            <span>Maybe</span>
                        </label>
                        <label class="flex items-center gap-2 text-slate-300">
                            <input type="radio" name="willPay" value="no" class="text-amber-500">
                            <span>No</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex gap-3 mt-6">
                <button onclick="submitFeedback()" class="flex-1 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-6 rounded-lg transition-all">
                    Submit Feedback
                </button>
                <button onclick="closeFeedback()" class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Crisis Mode Modal -->
    <div id="crisisModal" class="hidden fixed inset-0 bg-red-900/90 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-2xl w-full border-4 border-red-500 fade-in">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4 animate-bounce">üö®</div>
                <h2 class="text-3xl font-bold text-red-400 mb-2">CRISIS MODE ACTIVATED</h2>
                <p class="text-slate-300">Emergency HR support - Immediate response</p>
            </div>
            
            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-slate-300 font-medium mb-2">What's the urgent situation?</label>
                    <select id="crisisType" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white">
                        <option value="">Select crisis type...</option>
                        <option value="injury">Workplace Injury</option>
                        <option value="harassment">Sexual Harassment / Bullying</option>
                        <option value="theft">Theft / Serious Misconduct</option>
                        <option value="walkout">Employee Walkout / Strike</option>
                        <option value="discrimination">Discrimination Complaint</option>
                        <option value="violence">Workplace Violence / Threat</option>
                        <option value="death">Death / Medical Emergency</option>
                        <option value="other">Other Urgent Matter</option>
                    </select>
                </div>

                <div>
                    <label class="block text-slate-300 font-medium mb-2">Describe what happened (be specific):</label>
                    <textarea id="crisisDescription" rows="4" 
                              class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400"
                              placeholder="Provide details: who, what, when, where..."></textarea>
                </div>

                <div>
                    <label class="block text-slate-300 font-medium mb-2">Your contact number for urgent callback:</label>
                    <input type="tel" id="crisisPhone" 
                           class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white"
                           placeholder="04XX XXX XXX">
                </div>
            </div>

            <div class="bg-red-500/10 border-2 border-red-500 rounded-lg p-4 mb-6">
                <p class="text-red-300 font-bold mb-2">üö® IMMEDIATE ACTIONS:</p>
                <ul class="text-red-200 text-sm space-y-1 ml-4">
                    <li>‚Ä¢ Document everything NOW (photos, witnesses, times)</li>
                    <li>‚Ä¢ Do NOT investigate yourself</li>
                    <li>‚Ä¢ Separate involved parties immediately</li>
                    <li>‚Ä¢ Preserve evidence / CCTV footage</li>
                    <li>‚Ä¢ Contact emergency services if needed (000)</li>
                </ul>
            </div>

            <div class="flex gap-3">
                <button onclick="submitCrisis()" 
                        class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-6 rounded-lg transition-all text-lg">
                    üö® GET URGENT HELP NOW
                </button>
                <button onclick="closeCrisisModal()" 
                        class="px-6 py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all">
                    Cancel
                </button>
            </div>

            <p class="text-center text-slate-400 text-sm mt-4">
                A Senior Consultant will contact you within 15 minutes
            </p>
        </div>
    </div>

    <!-- Award Calculator Modal -->
    <div id="awardCalculatorModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-3xl w-full border border-amber-500 fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-amber-500 flex items-center gap-2">
                        <span>üí∞</span> Award Rate Calculator
                    </h2>
                    <p class="text-slate-400 text-sm">Calculate exact pay with penalties and loadings</p>
                </div>
                <button onclick="closeToolModal('awardCalculatorModal')" class="text-slate-400 hover:text-white text-2xl">√ó</button>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-slate-300 text-sm mb-2">Position / Classification</label>
                        <select id="calcPosition" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                            <option value="28.50">Level 1 (Intro) - $28.50</option>
                            <option value="29.85">Level 2 - $29.85</option>
                            <option value="31.20">Level 3 - $31.20</option>
                            <option value="33.89">Level 4 - $33.89</option>
                            <option value="36.58">Level 5 - $36.58</option>
                            <option value="custom">Custom Rate</option>
                        </select>
                    </div>

                    <div id="customRateDiv" class="hidden">
                        <label class="block text-slate-300 text-sm mb-2">Custom Base Rate ($/hr)</label>
                        <input type="number" id="calcCustomRate" step="0.01" 
                               class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm"
                               placeholder="28.50">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-slate-300 text-sm mb-2">Day of Week</label>
                        <select id="calcDay" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                            <option value="1.0">Monday-Friday</option>
                            <option value="1.5">Saturday</option>
                            <option value="1.75">Sunday</option>
                            <option value="2.5">Public Holiday</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-slate-300 text-sm mb-2">Hours Worked</label>
                        <input type="number" id="calcHours" step="0.5" value="8" 
                               class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                    </div>

                    <div>
                        <label class="block text-slate-300 text-sm mb-2">Overtime Hours</label>
                        <input type="number" id="calcOvertime" step="0.5" value="0" 
                               class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                    </div>
                </div>

                <button onclick="calculateAward()" 
                        class="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 rounded-lg transition-all">
                    Calculate Pay
                </button>

                <div id="calcResults" class="hidden bg-slate-900 border border-amber-500 rounded-lg p-6">
                    <h3 class="text-amber-500 font-bold text-lg mb-4">Pay Breakdown:</h3>
                    <div class="space-y-2 text-slate-200">
                        <div class="flex justify-between py-2 border-b border-slate-700">
                            <span>Base Rate:</span>
                            <span class="font-bold" id="resultBaseRate"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-slate-700">
                            <span>Penalty/Loading Rate:</span>
                            <span class="font-bold" id="resultPenaltyRate"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-slate-700">
                            <span>Ordinary Hours Pay:</span>
                            <span class="font-bold" id="resultOrdinaryPay"></span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-slate-700" id="overtimeRow">
                            <span>Overtime Pay (1.5x):</span>
                            <span class="font-bold" id="resultOvertimePay"></span>
                        </div>
                        <div class="flex justify-between py-3 bg-amber-500/10 px-3 rounded mt-3">
                            <span class="text-lg font-bold">TOTAL PAY:</span>
                            <span class="text-2xl font-bold text-amber-500" id="resultTotal"></span>
                        </div>
                    </div>
                    <button onclick="downloadCalculation()" 
                            class="w-full mt-4 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg transition-all text-sm">
                        üìä Download Excel Breakdown
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Roster Optimizer Modal -->
    <div id="rosterOptimizerModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-4xl w-full border border-amber-500 fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-amber-500 flex items-center gap-2">
                        <span>üìÖ</span> Roster Cost Optimizer
                    </h2>
                    <p class="text-slate-400 text-sm">Upload roster to analyze costs and optimize scheduling</p>
                </div>
                <button onclick="closeToolModal('rosterOptimizerModal')" class="text-slate-400 hover:text-white text-2xl">√ó</button>
            </div>

            <div class="space-y-6">
                <div class="bg-slate-900 border-2 border-dashed border-slate-600 rounded-lg p-8 text-center">
                    <input type="file" id="rosterUpload" accept=".xlsx,.xls,.csv" class="hidden" onchange="handleRosterUpload(event)">
                    <button onclick="document.getElementById('rosterUpload').click()" 
                            class="bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-6 rounded-lg transition-all">
                        üì§ Upload Current Roster
                    </button>
                    <p class="text-slate-400 text-sm mt-3">Supports Excel (.xlsx, .xls) or CSV files</p>
                </div>

                <div class="text-center text-slate-400">
                    <p class="mb-2">Or manually enter roster details:</p>
                    <button onclick="showManualRoster()" 
                            class="text-amber-500 hover:text-amber-400 underline">
                        Enter Roster Manually
                    </button>
                </div>

                <div id="rosterResults" class="hidden space-y-4">
                    <div class="bg-slate-900 border border-green-500 rounded-lg p-6">
                        <h3 class="text-green-500 font-bold text-lg mb-4">üìä Current Roster Analysis:</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-slate-800 p-4 rounded">
                                <p class="text-slate-400 text-sm">Total Labor Cost</p>
                                <p class="text-2xl font-bold text-white" id="rosterCurrentCost">$4,287</p>
                            </div>
                            <div class="bg-slate-800 p-4 rounded">
                                <p class="text-slate-400 text-sm">Total Hours</p>
                                <p class="text-2xl font-bold text-white" id="rosterTotalHours">147 hrs</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm" id="rosterIssues"></div>
                    </div>

                    <div class="bg-slate-900 border border-amber-500 rounded-lg p-6">
                        <h3 class="text-amber-500 font-bold text-lg mb-4">‚ú® Optimized Roster:</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-slate-800 p-4 rounded">
                                <p class="text-slate-400 text-sm">Optimized Cost</p>
                                <p class="text-2xl font-bold text-green-400" id="rosterOptimizedCost">$3,875</p>
                            </div>
                            <div class="bg-slate-800 p-4 rounded">
                                <p class="text-slate-400 text-sm">Savings</p>
                                <p class="text-2xl font-bold text-green-400" id="rosterSavings">$412</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm text-slate-300" id="rosterOptimizations"></div>
                        
                        <button onclick="downloadOptimizedRoster()" 
                                class="w-full mt-4 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 rounded-lg transition-all">
                            üì• Download Optimized Roster
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Termination Risk Assessor Modal -->
    <div id="terminationRiskModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-3xl w-full border border-amber-500 fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-amber-500 flex items-center gap-2">
                        <span>‚öñÔ∏è</span> Termination Risk Assessor
                    </h2>
                    <p class="text-slate-400 text-sm">Assess unfair dismissal risk before terminating employment</p>
                </div>
                <button onclick="closeToolModal('terminationRiskModal')" class="text-slate-400 hover:text-white text-2xl">√ó</button>
            </div>

            <form id="terminationForm" class="space-y-4">
                <div>
                    <label class="block text-slate-300 text-sm mb-2">How long has the employee worked for you?</label>
                    <select id="termTenure" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                        <option value="">Select...</option>
                        <option value="under6months">Under 6 months</option>
                        <option value="6to12months">6-12 months</option>
                        <option value="over12months">Over 12 months</option>
                    </select>
                </div>

                <div>
                    <label class="block text-slate-300 text-sm mb-2">Reason for termination:</label>
                    <select id="termReason" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                        <option value="">Select...</option>
                        <option value="performance">Poor Performance</option>
                        <option value="misconduct">Misconduct</option>
                        <option value="serious-misconduct">Serious Misconduct</option>
                        <option value="redundancy">Redundancy</option>
                        <option value="incompatibility">Not a Good Fit</option>
                    </select>
                </div>

                <div>
                    <label class="block text-slate-300 text-sm mb-2">Have you given formal warnings?</label>
                    <select id="termWarnings" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                        <option value="">Select...</option>
                        <option value="none">No warnings given</option>
                        <option value="verbal">Verbal warning only</option>
                        <option value="written">Written warning(s) given</option>
                        <option value="final">Final written warning given</option>
                    </select>
                </div>

                <div>
                    <label class="block text-slate-300 text-sm mb-2">Did you provide opportunity to improve?</label>
                    <select id="termImprovement" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                        <option value="">Select...</option>
                        <option value="no">No</option>
                        <option value="informal">Informal discussions only</option>
                        <option value="formal">Formal improvement plan with timeframe</option>
                    </select>
                </div>

                <div>
                    <label class="block text-slate-300 text-sm mb-2">Is the employee in any protected category?</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-2 text-slate-300 text-sm">
                            <input type="checkbox" id="termPregnant" class="rounded">
                            <span>Pregnant or on parental leave</span>
                        </label>
                        <label class="flex items-center gap-2 text-slate-300 text-sm">
                            <input type="checkbox" id="termInjured" class="rounded">
                            <span>Recently injured or on workers comp</span>
                        </label>
                        <label class="flex items-center gap-2 text-slate-300 text-sm">
                            <input type="checkbox" id="termComplaint" class="rounded">
                            <span>Made workplace complaint recently</span>
                        </label>
                        <label class="flex items-center gap-2 text-slate-300 text-sm">
                            <input type="checkbox" id="termUnion" class="rounded">
                            <span>Union member or delegate</span>
                        </label>
                    </div>
                </div>

                <button type="button" onclick="assessTerminationRisk()" 
                        class="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 rounded-lg transition-all">
                    Assess Risk
                </button>
            </form>

            <div id="termRiskResults" class="hidden mt-6"></div>
        </div>
    </div>

    <!-- Scenario Analysis Modal -->
    <div id="scenarioAnalysisModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-3xl w-full border border-amber-500 fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-amber-500 flex items-center gap-2">
                        <span>üéØ</span> Custom Scenario Analysis
                    </h2>
                    <p class="text-slate-400 text-sm">Get tailored advice for your specific situation</p>
                </div>
                <button onclick="closeToolModal('scenarioAnalysisModal')" class="text-slate-400 hover:text-white text-2xl">√ó</button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="block text-slate-300 text-sm mb-2">Tell me about your venue:</label>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="scenarioVenueType" placeholder="e.g., Restaurant, Hotel, Caf√©" 
                               class="bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm placeholder-slate-500">
                        <input type="text" id="scenarioLocation" placeholder="e.g., Sydney CBD" 
                               class="bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm placeholder-slate-500">
                    </div>
                </div>

                <div>
                    <label class="block text-slate-300 text-sm mb-2">Number of employees:</label>
                    <input type="number" id="scenarioStaffCount" placeholder="e.g., 15" 
                           class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-white text-sm">
                </div>

                <div>
                    <label class="block text-slate-300 text-sm mb-2">Describe your situation in detail:</label>
                    <textarea id="scenarioDescription" rows="6" 
                              class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-3 text-white text-sm placeholder-slate-400"
                              placeholder="Be as specific as possible: What's the issue? What's the context? What have you tried? What are your concerns?"></textarea>
                </div>

                <button onclick="analyzeScenario()" 
                        class="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 rounded-lg transition-all">
                    Generate Custom Analysis
                </button>

                <div id="scenarioResults" class="hidden"></div>
            </div>
        </div>
    </div>

    <!-- Xero Integration Modal -->
    <div id="xeroIntegrationModal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
        <div class="bg-slate-800 rounded-2xl p-8 max-w-2xl w-full border border-amber-500 fade-in">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-amber-500 flex items-center gap-2">
                        <span>üîó</span> Xero Payroll Integration
                    </h2>
                    <p class="text-slate-400 text-sm">Connect to Xero for automatic payroll analysis</p>
                </div>
                <button onclick="closeToolModal('xeroIntegrationModal')" class="text-slate-400 hover:text-white text-2xl">√ó</button>
            </div>

            <div id="xeroNotConnected" class="space-y-6">
                <div class="bg-blue-500/10 border border-blue-500 rounded-lg p-6">
                    <h3 class="text-blue-400 font-bold mb-3">What You'll Get:</h3>
                    <ul class="space-y-2 text-slate-300 text-sm">
                        <li class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Automatic labor cost analysis</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Overtime and penalty rate tracking</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Cost trend alerts</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-green-400">‚úì</span>
                            <span>Compliance risk detection</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-slate-900 border border-slate-700 rounded-lg p-6 text-center">
                    <p class="text-slate-300 mb-4">Connect your Xero account securely:</p>
                    <button onclick="connectXero()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-all inline-flex items-center gap-2">
                        <span>üîó</span>
                        <span>Connect to Xero</span>
                    </button>
                    <p class="text-slate-500 text-xs mt-3">Secure OAuth 2.0 connection</p>
                </div>
            </div>

            <div id="xeroConnected" class="hidden space-y-4">
                <div class="bg-green-500/10 border border-green-500 rounded-lg p-4 text-center">
                    <p class="text-green-400 font-bold">‚úì Connected to Xero</p>
                </div>
                <div class="space-y-3" id="xeroAnalysis"></div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // HR DOCUMENT TEMPLATES
        // ========================================
        const hrTemplates = {
            employmentContract: (data) => `
                <div class="header">
                    <h1>EMPLOYMENT CONTRACT</h1>
                    <p>Fitzgerald HR - Professional HR Solutions</p>
                </div>
                
                <h2>Employment Details</h2>
                <p><strong>Employee Name:</strong> ${data.employeeName || '[Employee Name]'}</p>
                <p><strong>Position:</strong> ${data.position || '[Position Title]'}</p>
                <p><strong>Start Date:</strong> ${data.startDate || '[Start Date]'}</p>
                <p><strong>Employment Type:</strong> ${data.employmentType || '[Full-time/Part-time/Casual]'}</p>
                <p><strong>Applicable Award:</strong> ${data.award || 'Hospitality Industry (General) Award'}</p>
                
                <h2>1. Position and Duties</h2>
                <p>${data.duties || '[Insert comprehensive list of key duties, responsibilities, and reporting lines]'}</p>
                
                <h2>2. Remuneration and Benefits</h2>
                <p><strong>Base Rate of Pay:</strong> ${data.baseRate || '[Rate]'} per ${data.payPeriod || 'hour'}</p>
                <p>Payment will be made ${data.paymentFrequency || 'fortnightly'} via direct deposit.</p>
                <p>In addition to the base rate, you will receive applicable penalty rates, loadings, and allowances as prescribed by the ${data.award || 'Hospitality Industry (General) Award'}.</p>
                
                <h2>3. Hours of Work</h2>
                <p>${data.hoursOfWork || '[Specify ordinary hours, roster arrangements, and any requirements for availability]'}</p>
                <p>Reasonable additional hours may be required from time to time, subject to the National Employment Standards.</p>
                
                <h2>4. Probationary Period</h2>
                <p>The first ${data.probationPeriod || '3 months'} of your employment will be considered a probationary period. During this time, your suitability for the role will be assessed. Either party may terminate employment during probation with ${data.probationNotice || '1 week\'s'} notice.</p>
                
                <h2>5. Leave Entitlements</h2>
                <p>You are entitled to leave in accordance with the National Employment Standards and the applicable Modern Award, including:</p>
                <ul>
                    <li>Annual leave (if applicable to employment type)</li>
                    <li>Personal/carer's leave</li>
                    <li>Compassionate and bereavement leave</li>
                    <li>Long service leave (after qualifying period)</li>
                    <li>Public holidays</li>
                </ul>
                
                <h2>6. Termination of Employment</h2>
                <p>Either party may terminate this employment by providing written notice as required by the National Employment Standards and the applicable Award.</p>
                
                <h2>7. Workplace Policies</h2>
                <p>You are required to comply with all workplace policies and procedures, including but not limited to workplace health and safety, equal opportunity, and code of conduct policies.</p>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è IMPORTANT LEGAL NOTICE</strong>
                    <p>This employment contract template has been generated by Fitz AI and is provided for guidance purposes only.</p>
                    <p><strong>You MUST have this contract reviewed and customised by a Fitzgerald HR Senior Consultant or employment lawyer before use.</strong></p>
                    <p>This ensures compliance with all applicable laws, awards, and your specific circumstances.</p>
                    <p><strong>Contact:</strong> info@fitzgeraldhr.com.au | Fitzgerald HR</p>
                </div>
                
                <div style="margin-top: 50px;">
                    <p><strong>Employee Signature:</strong> _________________________ <strong>Date:</strong> __________</p>
                    <p><strong>Employer Signature:</strong> _________________________ <strong>Date:</strong> __________</p>
                </div>
            `,
            
            warningLetter: (data) => `
                <div class="header">
                    <h1>WRITTEN WARNING</h1>
                    <p>Fitzgerald HR - Professional HR Solutions</p>
                </div>
                
                <p><strong>Date:</strong> ${data.date || new Date().toLocaleDateString('en-AU')}</p>
                <p><strong>Employee Name:</strong> ${data.employeeName || '[Employee Name]'}</p>
                <p><strong>Position:</strong> ${data.position || '[Position]'}</p>
                <p><strong>Employee ID:</strong> ${data.employeeId || '[Employee ID]'}</p>
                
                <h2>Subject: ${data.subject || 'Formal Written Warning'}</h2>
                
                <p>This letter serves as a formal written warning regarding ${data.issue || '[describe the issue or concern]'}.</p>
                
                <h2>Details of Incident/Issue</h2>
                <p><strong>Date(s) of Incident:</strong> ${data.incidentDate || '[Date(s)]'}</p>
                <p><strong>Description:</strong></p>
                <p>${data.description || '[Provide detailed, factual description of the incident, behaviour, or performance issue. Include specific examples, dates, times, and any witnesses if applicable]'}</p>
                
                <h2>Previous Discussions</h2>
                <p>${data.previousDiscussions || '[If applicable, note any prior verbal warnings or discussions about this matter, including dates]'}</p>
                
                <h2>Expected Standards and Behaviour</h2>
                <p>${data.expectations || '[Clearly outline the expected standards of conduct, performance, or behaviour moving forward. Reference relevant policies, position description, or award requirements]'}</p>
                
                <h2>Improvement Plan</h2>
                <p>${data.improvementPlan || '[Outline specific, measurable steps the employee must take to address the issue. Include timeframes and any support or resources available]'}</p>
                
                <h2>Consequences of Further Issues</h2>
                <p>Failure to meet these expectations and demonstrate sustained improvement may result in further disciplinary action, which may include:</p>
                <ul>
                    <li>A final written warning</li>
                    <li>Termination of employment</li>
                </ul>
                
                <h2>Support Available</h2>
                <p>${data.support || '[Outline any support, training, coaching, or resources available to help the employee improve. This demonstrates procedural fairness]'}</p>
                
                <h2>Right to Respond</h2>
                <p>You have the right to provide a written response to this warning within ${data.responseTimeframe || '7 days'}. Your response will be considered and placed on your employee file with this warning.</p>
                
                <p>This warning will remain on your employee file for ${data.warningDuration || '12 months'} from the date of this letter.</p>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è CRITICAL LEGAL RISK</strong>
                    <p>Performance management and disciplinary processes involve significant legal risks if not handled correctly.</p>
                    <p><strong>This template MUST be reviewed by a Fitzgerald HR Senior Consultant before being issued to any employee.</strong></p>
                    <p>Incorrect process may result in unfair dismissal claims, general protections claims, or adverse action claims.</p>
                    <p><strong>Contact immediately:</strong> info@fitzgeraldhr.com.au | Fitzgerald HR</p>
                </div>
                
                <div style="margin-top: 40px;">
                    <p><strong>I acknowledge receipt of this written warning:</strong></p>
                    <p><strong>Employee Signature:</strong> _________________________ <strong>Date:</strong> __________</p>
                    <p style="margin-top: 10px; font-size: 12px; color: #666;"><em>Signing this letter acknowledges receipt only and does not necessarily indicate agreement with its contents.</em></p>
                    <br/>
                    <p><strong>Manager/Supervisor Name:</strong> ${data.managerName || '[Manager Name]'}</p>
                    <p><strong>Manager Signature:</strong> _________________________ <strong>Date:</strong> __________</p>
                </div>
            `,
            
            performanceReview: (data) => `
                <div class="header">
                    <h1>PERFORMANCE REVIEW</h1>
                    <p>Fitzgerald HR - Professional HR Solutions</p>
                </div>
                
                <h2>Employee Information</h2>
                <p><strong>Employee Name:</strong> ${data.employeeName || '[Employee Name]'}</p>
                <p><strong>Position:</strong> ${data.position || '[Position]'}</p>
                <p><strong>Department/Location:</strong> ${data.department || '[Department]'}</p>
                <p><strong>Review Period:</strong> ${data.reviewPeriod || '[Start Date] to [End Date]'}</p>
                <p><strong>Review Date:</strong> ${data.reviewDate || new Date().toLocaleDateString('en-AU')}</p>
                <p><strong>Reviewer:</strong> ${data.reviewer || '[Manager/Supervisor Name]'}</p>
                
                <h2>Performance Summary</h2>
                <p>${data.summary || '[Provide an overall summary of the employee\'s performance during the review period. Consider achievements, challenges, growth, and overall contribution to the team and organisation]'}</p>
                
                <h2>Key Achievements and Successes</h2>
                <p>${data.achievements || '[List and describe significant achievements, successful projects, goals met or exceeded, positive contributions to team/workplace culture, and any special recognition received during the review period]'}</p>
                
                <h2>Core Competencies Assessment</h2>
                
                <h3>1. Job Knowledge and Skills</h3>
                <p>${data.jobKnowledge || '[Assess the employee\'s understanding of their role, technical skills, industry knowledge, and ability to perform required tasks]'}</p>
                
                <h3>2. Quality of Work</h3>
                <p>${data.qualityOfWork || '[Evaluate accuracy, attention to detail, consistency, and standard of work produced]'}</p>
                
                <h3>3. Productivity and Time Management</h3>
                <p>${data.productivity || '[Assess ability to meet deadlines, manage workload, prioritise tasks, and work efficiently]'}</p>
                
                <h3>4. Communication and Teamwork</h3>
                <p>${data.communication || '[Evaluate interpersonal skills, collaboration with colleagues, customer service, and contribution to team dynamics]'}</p>
                
                <h3>5. Initiative and Problem Solving</h3>
                <p>${data.initiative || '[Assess proactiveness, ability to identify and solve problems, willingness to take on new challenges]'}</p>
                
                <h3>6. Reliability and Attendance</h3>
                <p>${data.reliability || '[Review punctuality, attendance record, dependability, and adherence to rostering requirements]'}</p>
                
                <h2>Areas of Strength</h2>
                <p>${data.strengths || '[Identify specific areas where the employee excels. Be specific with examples]'}</p>
                
                <h2>Development Areas and Opportunities</h2>
                <p>${data.developmentAreas || '[Identify areas where improvement is needed or where the employee can further develop their skills. Frame constructively and with specific examples]'}</p>
                
                <h2>Goals and Objectives for Next Review Period</h2>
                <p>${data.goals || '[Set SMART goals (Specific, Measurable, Achievable, Relevant, Time-bound) for the upcoming review period. Align with both employee development and organisational objectives]'}</p>
                
                <h2>Training and Development Plan</h2>
                <p>${data.trainingPlan || '[Outline specific training, development opportunities, mentoring, or resources that will be provided to support the employee\'s growth and achievement of goals]'}</p>
                
                <h2>Career Progression Discussion</h2>
                <p>${data.careerDiscussion || '[If discussed, note any conversations about career aspirations, potential progression opportunities, or long-term development paths]'}</p>
                
                <h2>Overall Performance Rating</h2>
                <p><strong>Rating: ${data.rating || '[Exceeds Expectations / Meets Expectations / Needs Improvement / Unsatisfactory]'}</strong></p>
                
                <h2>Employee Comments</h2>
                <p>The employee has the opportunity to provide comments, feedback, or responses to this review:</p>
                <p>_________________________________________________________________________________</p>
                <p>_________________________________________________________________________________</p>
                <p>_________________________________________________________________________________</p>
                
                <div style="margin-top: 40px;">
                    <p><strong>Employee Signature:</strong> _________________________ <strong>Date:</strong> __________</p>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;"><em>Signature indicates that the review has been discussed with the employee, not necessarily agreement.</em></p>
                    <br/>
                    <p><strong>Reviewer Signature:</strong> _________________________ <strong>Date:</strong> __________</p>
                </div>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è IMPORTANT NOTE</strong>
                    <p>This performance review template has been generated by Fitz AI for guidance purposes.</p>
                    <p>For best results and to ensure procedural fairness, consider having your performance review process and documentation reviewed by a Fitzgerald HR Senior Consultant.</p>
                    <p><strong>Contact:</strong> info@fitzgeraldhr.com.au | Fitzgerald HR</p>
                </div>
            `
        };

        // ========================================
        // DOCUMENT GENERATION FUNCTIONS
        // ========================================
        
        function generateWordDocument(content, filename = 'document.doc', metadata = {}) {
            const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 40px; max-width: 800px; margin: 0 auto; }
        h1 { color: #E2A14A; border-bottom: 3px solid #E2A14A; padding-bottom: 10px; font-size: 24px; }
        h2 { color: #1E3A5F; margin-top: 25px; font-size: 18px; }
        h3 { color: #1E3A5F; margin-top: 20px; font-size: 16px; }
        .header { text-align: center; margin-bottom: 30px; }
        .footer { margin-top: 50px; border-top: 2px solid #ccc; padding-top: 20px; font-size: 11px; color: #666; }
        .warning { background: #fff3cd; border-left: 4px solid #ff6b6b; padding: 20px; margin: 25px 0; }
        strong { font-weight: bold; }
        ul { margin-left: 20px; }
        li { margin-bottom: 8px; }
        p { margin-bottom: 12px; }
    </style>
</head>
<body>
    ${content}
    
    <div class="footer">
        <p><strong>FITZGERALD HR</strong> - AI-Powered Hospitality HR Solutions</p>
        <p>Email: info@fitzgeraldhr.com.au | Phone: [Your Phone]</p>
        <p>This document was generated by Fitz, your AI HR Assistant, on ${new Date().toLocaleDateString('en-AU')} at ${new Date().toLocaleTimeString('en-AU')}</p>
        <p><strong>Document ID:</strong> ${metadata.documentId || 'N/A'} | <strong>Generated for:</strong> ${metadata.userName || 'Beta User'}</p>
        <p><em>For personalised advice and document review, contact our Senior Consultants.</em></p>
    </div>
</body>
</html>`;

            const blob = new Blob(['\ufeff', htmlContent], {
                type: 'application/msword'
            });
            
            saveAs(blob, filename);
            
            // Track document generation
            trackDocumentGeneration(filename, metadata);
            
            return true;
        }
        
        function generateExcelSpreadsheet(data, filename = 'spreadsheet.xlsx', sheetName = 'HR Data') {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(data);
            
            // Set column widths
            const colWidths = [];
            Object.keys(data[0] || {}).forEach(() => {
                colWidths.push({ wch: 20 });
            });
            ws['!cols'] = colWidths;
            
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
            XLSX.writeFile(wb, filename);
            
            // Track document generation
            trackDocumentGeneration(filename, { type: 'excel', rows: data.length });
            
            return true;
        }

        // ========================================
        // SMART DOCUMENT DETECTION & BUTTONS
        // ========================================
        
        function detectDocumentType(content) {
            const lowerContent = content.toLowerCase();
            
            const documentKeywords = {
                'employmentContract': ['employment contract', 'hire', 'new employee', 'employment agreement', 'contract of employment'],
                'warningLetter': ['warning', 'disciplinary', 'performance issue', 'misconduct', 'written warning'],
                'performanceReview': ['performance review', 'performance appraisal', 'performance evaluation', 'annual review']
            };
            
            for (const [docType, keywords] of Object.entries(documentKeywords)) {
                if (keywords.some(keyword => lowerContent.includes(keyword))) {
                    return docType;
                }
            }
            
            return null;
        }
        
        function extractDataFromConversation(messages, documentType) {
            // Parse conversation to extract relevant data
            const conversationText = messages.map(m => m.content).join(' ').toLowerCase();
            const data = {};
            
            // Extract employee name
            const nameMatch = conversationText.match(/(?:employee name|name is|called)\s+(?:is\s+)?([A-Z][a-z]+\s+[A-Z][a-z]+)/i);
            if (nameMatch) data.employeeName = nameMatch[1];
            
            // Extract position
            const positionMatch = conversationText.match(/(?:position|role|job)\s+(?:is|as|of)?\s+([a-z\s]+?)(?:\s|,|\.|$)/i);
            if (positionMatch) data.position = positionMatch[1].trim();
            
            // Extract date
            const dateMatch = conversationText.match(/(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})/);
            if (dateMatch) data.startDate = dateMatch[1];
            
            // Extract rate
            const rateMatch = conversationText.match(/\$?(\d+(?:\.\d{2})?)\s*(?:per hour|\/hr|hourly)/i);
            if (rateMatch) data.baseRate = rateMatch[1];
            
            // Document-specific extraction
            if (documentType === 'warningLetter') {
                const issueMatch = conversationText.match(/(?:issue|problem|concern).*?(?:is|was|regarding)\s+([^.]+)/i);
                if (issueMatch) data.issue = issueMatch[1];
            }
            
            return data;
        }
        
        function addDocumentDownloadButtons(messageDiv, documentType, conversationData) {
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'mt-4 p-4 bg-slate-700/50 rounded-lg border border-amber-500/30';
            
            const documentNames = {
                'employmentContract': 'Employment Contract',
                'warningLetter': 'Warning Letter',
                'performanceReview': 'Performance Review'
            };
            
            buttonContainer.innerHTML = `
                <div class="flex items-center justify-between mb-3">
                    <p class="text-amber-400 font-semibold flex items-center gap-2">
                        <span>üìÑ</span>
                        <span>Generate ${documentNames[documentType]}</span>
                    </p>
                </div>
                <p class="text-slate-300 text-sm mb-3">Based on our conversation, I can generate a customized template for you:</p>
                <div class="flex gap-2 flex-wrap">
                    <button onclick="downloadDocument('${documentType}', 'word')" 
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm font-medium">
                        <span>üìù</span> Download Word Doc
                    </button>
                    <button onclick="downloadDocument('${documentType}', 'pdf')" 
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors flex items-center gap-2 text-sm font-medium">
                        <span>üìÑ</span> Download PDF
                    </button>
                </div>
                <p class="text-xs text-slate-400 mt-3 flex items-start gap-2">
                    <span>‚ö†Ô∏è</span>
                    <span>This template must be reviewed by a Senior Consultant before use</span>
                </p>
            `;
            
            messageDiv.querySelector('.max-w-3xl').appendChild(buttonContainer);
        }
        
        function downloadDocument(documentType, format) {
            // Show disclaimer first
            const confirmed = confirm(
                "‚ö†Ô∏è IMPORTANT LEGAL DISCLAIMER\n\n" +
                "This document is a TEMPLATE generated by Fitz AI for guidance purposes only.\n\n" +
                "Before using this document:\n" +
                "‚úì You MUST have it reviewed by a Fitzgerald HR Senior Consultant\n" +
                "‚úì This ensures legal compliance and protects your business\n" +
                "‚úì Templates may need customization for your specific situation\n\n" +
                "Failure to have documents professionally reviewed may expose you to legal risks.\n\n" +
                "Contact: info@fitzgeraldhr.com.au\n\n" +
                "Click OK to download template, or Cancel to return."
            );
            
            if (!confirmed) return;
            
            // Extract data from conversation
            const data = extractDataFromConversation(conversationHistory, documentType);
            
            // Add metadata
            const metadata = {
                documentId: generateDocumentId(),
                userName: currentUser,
                generatedAt: new Date().toISOString(),
                documentType: documentType
            };
            
            // Generate document content
            const template = hrTemplates[documentType];
            if (!template) {
                alert('Template not found');
                return;
            }
            
            const content = template(data);
            
            // Generate filename
            const timestamp = new Date().toISOString().slice(0,10);
            const filename = `${documentType}_${timestamp}.${format === 'word' ? 'doc' : 'pdf'}`;
            
            // Download
            if (format === 'word') {
                generateWordDocument(content, filename, metadata);
            } else {
                generatePDFDocument(content, filename);
            }
            
            // Show confirmation
            alert(`‚úì Document downloaded: ${filename}\n\n` +
                  `Remember to have this reviewed by a Senior Consultant before use.\n` +
                  `Contact: info@fitzgeraldhr.com.au`);
        }
        
        function generatePDFDocument(content, filename = 'document.pdf') {
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>${filename}</title>
    <style>
        @media print {
            body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20mm; font-size: 11pt; }
            h1 { color: #E2A14A; border-bottom: 3px solid #E2A14A; page-break-after: avoid; }
            h2 { color: #1E3A5F; page-break-after: avoid; margin-top: 20px; }
            .warning { background: #fff3cd; border-left: 4px solid #ff6b6b; padding: 15px; page-break-inside: avoid; }
            .no-print { display: none; }
            .header { text-align: center; margin-bottom: 20px; }
        }
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 40px; max-width: 800px; margin: 0 auto; }
        h1 { color: #E2A14A; border-bottom: 3px solid #E2A14A; }
        h2 { color: #1E3A5F; margin-top: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .warning { background: #fff3cd; border-left: 4px solid #ff6b6b; padding: 20px; margin: 25px 0; }
        ul { margin-left: 20px; }
        li { margin-bottom: 8px; }
    </style>
</head>
<body>
    ${content}
    <div class="no-print" style="margin-top: 40px; text-align: center; padding: 20px; background: #f0f0f0; border-radius: 10px;">
        <p style="margin-bottom: 15px; font-size: 16px; color: #333;">Use your browser's print function and select "Save as PDF"</p>
        <button onclick="window.print()" style="padding: 12px 24px; font-size: 16px; background: #E2A14A; border: none; color: white; border-radius: 5px; cursor: pointer; margin-right: 10px;">Print / Save as PDF</button>
        <button onclick="window.close()" style="padding: 12px 24px; font-size: 16px; background: #666; border: none; color: white; border-radius: 5px; cursor: pointer;">Close</button>
    </div>
</body>
</html>`);
            
            printWindow.document.close();
            return true;
        }
        
        // ========================================
        // ADVANCED FEATURES
        // ========================================
        
        // 1. Document Metadata Tracking
        function trackDocumentGeneration(filename, metadata) {
            const documentLog = {
                filename: filename,
                user: currentUser,
                timestamp: new Date().toISOString(),
                ...metadata
            };
            
            // Store in localStorage for tracking
            const existingLogs = JSON.parse(localStorage.getItem('documentGenerationLogs') || '[]');
            existingLogs.push(documentLog);
            localStorage.setItem('documentGenerationLogs', JSON.stringify(existingLogs));
            
            // Also track as event
            trackEvent('document_generated', documentLog);
            
            console.log('Document generated:', documentLog);
        }
        
        function generateDocumentId() {
            return 'DOC-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }
        
        // 2. Multi-page document generation
        function generateMultiPageDocument(sections, filename, metadata = {}) {
            let fullContent = '';
            
            sections.forEach((section, index) => {
                fullContent += section.content;
                
                // Add page break between sections (for PDF/Word)
                if (index < sections.length - 1) {
                    fullContent += '<div style="page-break-after: always;"></div>';
                }
            });
            
            generateWordDocument(fullContent, filename, metadata);
        }
        
        // Example usage for complex documents:
        // generateMultiPageDocument([
        //     { content: hrTemplates.employmentContract(data), title: 'Employment Contract' },
        //     { content: generatePolicySection(data), title: 'Workplace Policies' },
        //     { content: generateBenefitsSection(data), title: 'Benefits Summary' }
        // ], 'Complete_Employment_Package.doc');

        // ========================================
        // MAIN APPLICATION CODE
        // ========================================
        
        // Valid access codes (you can add more)
        const VALID_CODES = [
            'BETA-VENUE-001',
            'BETA-VENUE-002',
            'BETA-VENUE-003',
            'BETA-VENUE-004',
            'BETA-VENUE-005',
            'FITZGERALD-TEST',
            'DEMO-2025'
        ];

        let currentUser = null;
        let conversationHistory = [];
        let feedbackRating = 0;

        // Access code check
        function checkAccess() {
            const input = document.getElementById('accessCodeInput').value.trim().toUpperCase();
            const error = document.getElementById('accessError');
            
            if (VALID_CODES.includes(input)) {
                currentUser = input;
                document.getElementById('userCode').textContent = input;
                document.getElementById('accessScreen').classList.add('hidden');
                document.getElementById('assistantScreen').classList.remove('hidden');
                error.classList.add('hidden');
                
                // Track access
                trackEvent('beta_access', { code: input });
            } else {
                error.textContent = 'Invalid access code. Please check and try again.';
                error.classList.remove('hidden');
            }
        }

        // Send message to AI
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to UI
            addMessage('user', message);
            input.value = '';
            
            // Show "Fitz is thinking..." indicator
            const thinkingDiv = showThinkingIndicator();
            
            // Disable send button
            const sendBtn = document.getElementById('sendButton');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="pulse">‚óè‚óè‚óè</span>';
            
            // Add to conversation history
            conversationHistory.push({ role: 'user', content: message });
            
            try {
                // Call Claude API (you'll need to replace this with your actual API endpoint)
                const response = await callClaudeAPI(message);
                
                // Remove thinking indicator
                removeThinkingIndicator(thinkingDiv);
                
                // Add AI response to UI
                addMessage('assistant', response);
                conversationHistory.push({ role: 'assistant', content: response });
                
                // Track usage
                trackEvent('message_sent', { 
                    user: currentUser,
                    messageLength: message.length 
                });
                
            } catch (error) {
                // Remove thinking indicator
                removeThinkingIndicator(thinkingDiv);
                
                addMessage('assistant', 'Sorry, I encountered an error. Please try again or contact support if the issue persists.');
                console.error('Error:', error);
            }
            
            // Re-enable send button
            sendBtn.disabled = false;
            sendBtn.innerHTML = '<span>Send</span><span>‚Üí</span>';
        }

        // Show thinking indicator
        function showThinkingIndicator() {
            const container = document.getElementById('messagesContainer').querySelector('.space-y-6');
            const thinkingDiv = document.createElement('div');
            thinkingDiv.id = 'thinking-indicator';
            thinkingDiv.className = 'flex justify-start fade-in';
            
            thinkingDiv.innerHTML = `
                <div class="max-w-3xl bg-slate-800 border border-slate-700 rounded-2xl px-6 py-4">
                    <div class="flex items-center gap-3">
                        <div class="flex gap-1">
                            <div class="w-2 h-2 bg-amber-500 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                            <div class="w-2 h-2 bg-amber-500 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                            <div class="w-2 h-2 bg-amber-500 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                        </div>
                        <p class="text-slate-400 text-sm">Fitz is thinking...</p>
                    </div>
                </div>
            `;
            
            container.appendChild(thinkingDiv);
            thinkingDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            
            return thinkingDiv;
        }

        // Remove thinking indicator
        function removeThinkingIndicator(thinkingDiv) {
            if (thinkingDiv && thinkingDiv.parentNode) {
                thinkingDiv.parentNode.removeChild(thinkingDiv);
            }
        }

        // Add message to UI
        function addMessage(role, content) {
            const container = document.getElementById('messagesContainer').querySelector('.space-y-6');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} fade-in`;
            
            // Check if content has legal warning and format it
            let formattedContent = content;
            if (role === 'assistant') {
                // Look for legal warnings at the start and make them bold and prominent
                const legalWarnings = [
                    '‚ö†Ô∏è **This matter involves legal risk.**',
                    '‚ö†Ô∏è This matter involves legal risk.'
                ];
                
                for (const warning of legalWarnings) {
                    if (content.includes(warning)) {
                        // Move warning to start and make it bold/red
                        formattedContent = content.replace(warning, '');
                        formattedContent = `<div class="mb-4 p-4 bg-red-500/10 border-2 border-red-500 rounded-lg">
                            <p class="text-red-400 font-bold text-lg flex items-center gap-2">
                                <span class="text-2xl">‚ö†Ô∏è</span>
                                <span>IMPORTANT: This matter involves legal risk.</span>
                            </p>
                            <p class="text-red-300 mt-2">Please contact one of our Senior Consultants at <a href="mailto:info@fitzgeraldhr.com.au" class="underline hover:text-red-200">info@fitzgeraldhr.com.au</a> for expert guidance on your specific situation and next steps.</p>
                        </div>` + formattedContent.replace('Please contact one of our Senior Consultants at info@fitzgeraldhr.com.au for expert guidance on your specific situation and next steps.', '');
                        break;
                    }
                }
                
                // Format other call-to-actions and make links clickable
                formattedContent = formattedContent
                    .replace(/üìû \*\*Need personalised support\?\*\*/g, '<strong class="text-amber-400">üìû Need personalised support?</strong>')
                    .replace(/‚úâÔ∏è \*\*Questions or need further assistance\?\*\*/g, '<strong class="text-amber-400">‚úâÔ∏è Questions or need further assistance?</strong>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/info@fitzgeraldhr\.com\.au/g, '<a href="mailto:info@fitzgeraldhr.com.au" class="text-amber-400 hover:underline">info@fitzgeraldhr.com.au</a>');
            }
            
            messageDiv.innerHTML = `
                <div class="max-w-3xl ${role === 'user' ? 'bg-amber-500 text-slate-900' : 'bg-slate-800 text-slate-100 border border-slate-700'} rounded-2xl px-6 py-4">
                    <p class="leading-relaxed whitespace-pre-wrap">${formattedContent}</p>
                </div>
            `;
            
            container.appendChild(messageDiv);
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            
            // AUTOMATIC DOCUMENT DETECTION - Check if assistant response mentions documents
            if (role === 'assistant') {
                const detectedDocType = detectDocumentType(content);
                if (detectedDocType) {
                    setTimeout(() => {
                        addDocumentDownloadButtons(messageDiv, detectedDocType, conversationHistory);
                    }, 500);
                }
            }
        }

        // Call Claude API through Netlify Function
        async function callClaudeAPI(message) {
            try {
                const response = await fetch('/.netlify/functions/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        history: conversationHistory.filter(m => m.role !== 'system'),
                        user: currentUser
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to get response');
                }

                const data = await response.json();
                return data.message;

            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Feedback functions
        function showFeedback() {
            document.getElementById('feedbackModal').classList.remove('hidden');
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').classList.add('hidden');
        }

        function setRating(rating) {
            feedbackRating = rating;
            document.querySelectorAll('.rating-btn').forEach((btn, idx) => {
                if (idx < rating) {
                    btn.classList.add('bg-amber-500');
                    btn.classList.remove('bg-slate-700');
                } else {
                    btn.classList.remove('bg-amber-500');
                    btn.classList.add('bg-slate-700');
                }
            });
        }

        function submitFeedback() {
            const likes = document.getElementById('feedbackLikes').value;
            const improve = document.getElementById('feedbackImprove').value;
            const willPay = document.querySelector('input[name="willPay"]:checked')?.value;
            
            // Track feedback
            trackEvent('beta_feedback', {
                user: currentUser,
                rating: feedbackRating,
                likes: likes,
                improve: improve,
                willPay: willPay
            });
            
            alert('Thank you for your feedback! This helps us improve.');
            closeFeedback();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                location.reload();
            }
        }

        // Analytics tracking (you can connect this to Google Analytics or your own system)
        function trackEvent(eventName, data) {
            console.log('Event:', eventName, data);
            // TODO: Send to your analytics platform
            // Example: gtag('event', eventName, data);
        }

        // ========================================
        // NEW FEATURES - CRISIS MODE
        // ========================================
        
        function activateCrisisMode() {
            document.getElementById('crisisModal').classList.remove('hidden');
            trackEvent('crisis_mode_activated', { user: currentUser });
        }

        function closeCrisisModal() {
            document.getElementById('crisisModal').classList.add('hidden');
        }

        async function submitCrisis() {
    const crisisType = document.getElementById('crisisType').value;
    const description = document.getElementById('crisisDescription').value;
    const phone = document.getElementById('crisisPhone').value;

    if (!crisisType || !description || !phone) {
        alert('Please fill in all fields for urgent assistance');
        return;
    }

    const submitBtn = document.querySelector('#crisisModal button[onclick="submitCrisis()"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="animate-pulse">‚è≥ Sending urgent alert...</span>';

    try {
        // Send to Telegram via Netlify function
        const response = await fetch('/.netlify/functions/telegram-crisis', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                crisisType,
                description,
                phone,
                user: currentUser
            })
        });

        const result = await response.json();

        if (response.ok) {
            const crisisData = {
                user: currentUser,
                type: crisisType,
                description: description,
                phone: phone,
                timestamp: new Date().toISOString(),
                crisisId: result.crisisId
            };
            
            const crisisLog = JSON.parse(localStorage.getItem('crisisSubmissions') || '[]');
            crisisLog.push(crisisData);
            localStorage.setItem('crisisSubmissions', JSON.stringify(crisisLog));
            
            trackEvent('crisis_submitted', crisisData);

            alert(`üö® URGENT ALERT SENT VIA TELEGRAM

Your crisis notification has been sent.

A Senior Consultant will contact you at ${phone} within 15 minutes.

Crisis ID: ${result.crisisId}

In the meantime:
- Document everything NOW
- Preserve evidence/CCTV
- Separate involved parties
- Call 000 if immediate danger`);
            
            const crisisGuidance = {
                'injury': 'IMMEDIATE ACTIONS:\n1. Call 000 if serious\n2. Provide first aid\n3. Document incident\n4. Notify WorkCover within 48hrs\n5. Preserve evidence\n\nDO NOT: Move injured person unless necessary',
                'harassment': 'IMMEDIATE ACTIONS:\n1. Separate complainant and alleged harasser\n2. DO NOT investigate yourself\n3. Document complaint in writing\n4. Preserve evidence (texts, emails)\n5. Ensure no retaliation\n\nDO NOT: Dismiss the complaint',
                'theft': 'IMMEDIATE ACTIONS:\n1. Secure evidence\n2. Review CCTV footage\n3. Document inventory loss\n4. DO NOT accuse without evidence\n5. Consider police report\n\nDO NOT: Confront employee alone',
                'violence': 'IMMEDIATE ACTIONS:\n1. CALL 000 IMMEDIATELY\n2. Evacuate if necessary\n3. Secure the area\n4. Do not confront\n5. Document everything\n\nDO NOT: Put yourself at risk',
                'walkout': 'IMMEDIATE ACTIONS:\n1. Document who walked out\n2. Do NOT threaten employees\n3. Seek legal advice\n4. Check employment contracts\n5. Consider Fair Work mediation',
                'discrimination': 'IMMEDIATE ACTIONS:\n1. Document complaint in detail\n2. Do NOT dismiss or minimize\n3. Separate involved parties\n4. Preserve all evidence\n5. Seek immediate legal advice',
                'death': 'IMMEDIATE ACTIONS:\n1. Call 000 IMMEDIATELY\n2. Do NOT move the body\n3. Secure the area\n4. Notify WorkSafe\n5. Support affected staff',
                'other': 'IMMEDIATE ACTIONS:\n1. Document everything\n2. Preserve all evidence\n3. Separate involved parties\n4. Do NOT take hasty action\n5. Wait for consultant guidance'
            };

            if (crisisGuidance[crisisType]) {
                addMessage('assistant', `üö® URGENT GUIDANCE FOR ${crisisType.toUpperCase()}:\n\n${crisisGuidance[crisisType]}\n\n‚ö†Ô∏è Telegram alert sent. A Senior Consultant will call you at ${phone} within 15 minutes.`);
            }
            
            closeCrisisModal();
            
        } else {
            throw new Error(result.error || 'Failed to send alert');
        }
        
    } catch (error) {
        console.error('Crisis submission error:', error);
        
        alert(`‚ö†Ô∏è TELEGRAM ALERT FAILED

Error sending notification.

PLEASE CALL IMMEDIATELY:
+61 400 211 014

Your submission has been logged locally.`);
        
        const crisisData = {
            user: currentUser,
            type: crisisType,
            description: description,
            phone: phone,
            timestamp: new Date().toISOString(),
            failed: true,
            error: error.message
        };
        
        const crisisLog = JSON.parse(localStorage.getItem('crisisSubmissions') || '[]');
        crisisLog.push(crisisData);
        localStorage.setItem('crisisSubmissions', JSON.stringify(crisisLog));
        
        trackEvent('crisis_submission_failed', crisisData);
        
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

        // ========================================
        // VOICE INPUT
        // ========================================
        
        let recognition = null;
        let isListening = false;

        function toggleVoiceInput() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice input not supported in your browser. Try Chrome or Edge.');
                return;
            }

            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        function startListening() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-AU';

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('voiceIcon').textContent = 'üî¥';
                document.getElementById('voiceButton').classList.add('bg-red-600');
                document.getElementById('messageInput').placeholder = 'Listening...';
            };

            recognition.onresult = (event) => {
                const transcript = Array.from(event.results)
                    .map(result => result[0].transcript)
                    .join('');
                document.getElementById('messageInput').value = transcript;
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                stopListening();
            };

            recognition.onend = () => {
                stopListening();
            };

            recognition.start();
        }

        function stopListening() {
            if (recognition) {
                recognition.stop();
            }
            isListening = false;
            document.getElementById('voiceIcon').textContent = 'üé§';
            document.getElementById('voiceButton').classList.remove('bg-red-600');
            document.getElementById('messageInput').placeholder = 'Ask me anything about hospitality HR in Australia...';
        }

        // ========================================
        // TOOLS MENU
        // ========================================
        
        function toggleToolsMenu() {
            const menu = document.getElementById('toolsMenu');
            menu.classList.toggle('hidden');
        }

        function openTool(toolName) {
            toggleToolsMenu();
            
            const modalMap = {
                'awardCalculator': 'awardCalculatorModal',
                'rosterOptimizer': 'rosterOptimizerModal',
                'terminationRisk': 'terminationRiskModal',
                'scenarioAnalysis': 'scenarioAnalysisModal',
                'xeroIntegration': 'xeroIntegrationModal'
            };

            const modalId = modalMap[toolName];
            if (modalId) {
                document.getElementById(modalId).classList.remove('hidden');
                trackEvent('tool_opened', { tool: toolName, user: currentUser });
            }
        }

        function closeToolModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // ========================================
        // AWARD CALCULATOR
        // ========================================
        
        document.getElementById('calcPosition')?.addEventListener('change', function() {
            const customDiv = document.getElementById('customRateDiv');
            if (this.value === 'custom') {
                customDiv.classList.remove('hidden');
            } else {
                customDiv.classList.add('hidden');
            }
        });

        function calculateAward() {
            let baseRate = parseFloat(document.getElementById('calcPosition').value);
            if (document.getElementById('calcPosition').value === 'custom') {
                baseRate = parseFloat(document.getElementById('calcCustomRate').value);
            }

            const dayMultiplier = parseFloat(document.getElementById('calcDay').value);
            const hours = parseFloat(document.getElementById('calcHours').value);
            const overtime = parseFloat(document.getElementById('calcOvertime').value);

            if (!baseRate || !hours) {
                alert('Please enter all required fields');
                return;
            }

            const penaltyRate = baseRate * dayMultiplier;
            const ordinaryPay = penaltyRate * hours;
            const overtimePay = overtime > 0 ? (baseRate * 1.5 * overtime) : 0;
            const totalPay = ordinaryPay + overtimePay;

            // Display results
            document.getElementById('resultBaseRate').textContent = `${baseRate.toFixed(2)}/hr`;
            document.getElementById('resultPenaltyRate').textContent = `${penaltyRate.toFixed(2)}/hr (${dayMultiplier}x)`;
            document.getElementById('resultOrdinaryPay').textContent = `${ordinaryPay.toFixed(2)}`;
            document.getElementById('resultOvertimePay').textContent = `${overtimePay.toFixed(2)}`;
            document.getElementById('resultTotal').textContent = `${totalPay.toFixed(2)}`;

            if (overtime > 0) {
                document.getElementById('overtimeRow').classList.remove('hidden');
            } else {
                document.getElementById('overtimeRow').classList.add('hidden');
            }

            document.getElementById('calcResults').classList.remove('hidden');

            trackEvent('award_calculated', {
                user: currentUser,
                baseRate: baseRate,
                totalPay: totalPay
            });
        }

        function downloadCalculation() {
            const data = [{
                'Description': 'Base Rate',
                'Rate': document.getElementById('resultBaseRate').textContent,
                'Hours': document.getElementById('calcHours').value,
                'Amount': document.getElementById('resultOrdinaryPay').textContent
            }];

            if (parseFloat(document.getElementById('calcOvertime').value) > 0) {
                data.push({
                    'Description': 'Overtime',
                    'Rate': `${(parseFloat(document.getElementById('calcPosition').value) * 1.5).toFixed(2)}/hr`,
                    'Hours': document.getElementById('calcOvertime').value,
                    'Amount': document.getElementById('resultOvertimePay').textContent
                });
            }

            data.push({
                'Description': 'TOTAL',
                'Rate': '',
                'Hours': '',
                'Amount': document.getElementById('resultTotal').textContent
            });

            generateExcelSpreadsheet(data, `Pay_Calculation_${Date.now()}.xlsx`, 'Pay Breakdown');
        }

        // ========================================
        // ROSTER OPTIMIZER
        // ========================================
        
        function handleRosterUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                // Simulate analysis
                setTimeout(() => {
                    document.getElementById('rosterResults').classList.remove('hidden');
                    
                    // Mock analysis results
                    document.getElementById('rosterIssues').innerHTML = `
                        <p class="text-yellow-400">‚ö†Ô∏è 3 compliance issues found:</p>
                        <ul class="ml-4 mt-2 space-y-1 text-slate-300">
                            <li>‚Ä¢ John: 6 consecutive days (max 5 recommended)</li>
                            <li>‚Ä¢ Sarah: No meal break on 7-hour shift</li>
                            <li>‚Ä¢ Mike: 52 hours this week (overtime alert)</li>
                        </ul>
                    `;

                    document.getElementById('rosterOptimizations').innerHTML = `
                        <p class="text-green-400 mb-2">üí° Optimization suggestions:</p>
                        <ul class="ml-4 space-y-2">
                            <li>‚úì Move John's Sunday shift to Tuesday (saves $87 penalty)</li>
                            <li>‚úì Split Sarah's shift into 2 shorter shifts (avoids meal break)</li>
                            <li>‚úì Reduce Mike's hours to 38 (saves $142 overtime)</li>
                            <li>‚úì Swap 3 casual staff to non-penalty days (saves $183)</li>
                        </ul>
                    `;

                    trackEvent('roster_uploaded', { user: currentUser, filename: file.name });
                }, 1500);
            };
            reader.readAsArrayBuffer(file);
        }

        function showManualRoster() {
            alert('Manual roster entry coming soon! For now, please upload an Excel/CSV file.');
        }

        function downloadOptimizedRoster() {
            // Mock optimized roster data
            const data = [
                { Employee: 'John Smith', Monday: '9am-5pm', Tuesday: '9am-5pm', Wednesday: 'OFF', Thursday: '2pm-10pm', Friday: '2pm-10pm', Saturday: 'OFF', Sunday: 'OFF', 'Weekly Cost': '$912' },
                { Employee: 'Sarah Jones', Monday: '10am-3pm', Tuesday: '10am-3pm', Wednesday: '10am-3pm', Thursday: '10am-3pm', Friday: '10am-3pm', Saturday: '9am-5pm', Sunday: 'OFF', 'Weekly Cost': '$876' }
            ];

            generateExcelSpreadsheet(data, `Optimized_Roster_${Date.now()}.xlsx`, 'Optimized Roster');
            
            alert('‚úì Optimized roster downloaded!\n\nImplement these changes to save $412 this week.\n\nNote: Have roster reviewed by Senior Consultant before implementing.');
        }

        // ========================================
        // TERMINATION RISK ASSESSOR
        // ========================================
        
        function assessTerminationRisk() {
            const tenure = document.getElementById('termTenure').value;
            const reason = document.getElementById('termReason').value;
            const warnings = document.getElementById('termWarnings').value;
            const improvement = document.getElementById('termImprovement').value;
            const pregnant = document.getElementById('termPregnant').checked;
            const injured = document.getElementById('termInjured').checked;
            const complaint = document.getElementById('termComplaint').checked;
            const union = document.getElementById('termUnion').checked;

            if (!tenure || !reason || !warnings || !improvement) {
                alert('Please answer all questions');
                return;
            }

            let riskScore = 0;
            let riskFactors = [];

            // Calculate risk
            if (tenure === 'over12months') riskScore += 30;
            if (reason === 'performance' && warnings === 'none') riskScore += 40;
            if (reason === 'incompatibility') riskScore += 35;
            if (warnings === 'none' || warnings === 'verbal') riskScore += 30;
            if (improvement === 'no' || improvement === 'informal') riskScore += 25;
            if (pregnant) { riskScore += 50; riskFactors.push('Pregnancy (PROTECTED - HIGH RISK)'); }
            if (injured) { riskScore += 40; riskFactors.push('Workers compensation (PROTECTED)'); }
            if (complaint) { riskScore += 45; riskFactors.push('Recent complaint (PROTECTED)'); }
            if (union) { riskScore += 35; riskFactors.push('Union involvement (PROTECTED)'); }

            if (reason === 'serious-misconduct') riskScore -= 30;
            if (warnings === 'final') riskScore -= 15;
            if (tenure === 'under6months') riskScore -= 20;

            let riskLevel, riskColor, riskMessage, recommendations;

            if (riskScore < 30) {
                riskLevel = 'LOW RISK';
                riskColor = 'green';
                riskMessage = 'Termination appears procedurally fair based on the information provided.';
                recommendations = [
                    'Ensure all documentation is in order',
                    'Provide required notice period',
                    'Prepare termination letter',
                    'Consider offering final pay on the spot',
                    'Still recommend consultant review before proceeding'
                ];
            } else if (riskScore < 60) {
                riskLevel = 'MEDIUM RISK';
                riskColor = 'yellow';
                riskMessage = 'Some procedural gaps exist. Rectify before terminating.';
                recommendations = [
                    'Provide formal warning first',
                    'Implement performance improvement plan',
                    'Document all discussions',
                    'Allow reasonable time to improve',
                    'MUST consult Senior Consultant before terminating'
                ];
            } else {
                riskLevel = 'HIGH RISK - DO NOT PROCEED';
                riskColor = 'red';
                riskMessage = 'Significant unfair dismissal risk. Terminating now likely results in claim.';
                recommendations = [
                    'DO NOT TERMINATE without expert guidance',
                    'Contact Senior Consultant IMMEDIATELY',
                    'Potential claim cost: $15,000-$50,000+',
                    'Follow proper process first',
                    'Consider alternatives to termination'
                ];
            }

            // Display results
            const resultsDiv = document.getElementById('termRiskResults');
            resultsDiv.innerHTML = `
                <div class="bg-${riskColor}-500/10 border-2 border-${riskColor}-500 rounded-lg p-6">
                    <h3 class="text-${riskColor}-400 font-bold text-xl mb-3 flex items-center gap-2">
                        ${riskColor === 'red' ? 'üö®' : riskColor === 'yellow' ? '‚ö†Ô∏è' : '‚úì'}
                        <span>${riskLevel}</span>
                    </h3>
                    <p class="text-slate-200 mb-4">${riskMessage}</p>
                    
                    ${riskFactors.length > 0 ? `
                        <div class="bg-red-500/20 border border-red-500 rounded p-3 mb-4">
                            <p class="text-red-300 font-bold mb-2">üõ°Ô∏è Protected Characteristics Detected:</p>
                            <ul class="ml-4 space-y-1 text-red-200 text-sm">
                                ${riskFactors.map(f => `<li>‚Ä¢ ${f}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    <div class="mt-4">
                        <p class="text-slate-300 font-bold mb-2">Recommended Actions:</p>
                        <ul class="ml-4 space-y-2 text-slate-300 text-sm">
                            ${recommendations.map(r => `<li>‚Ä¢ ${r}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-${riskColor}-500/30">
                        <button onclick="contactConsultantFromRisk()" 
                                class="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 rounded-lg transition-all">
                            üìû Contact Senior Consultant Now
                        </button>
                    </div>
                </div>
            `;

            resultsDiv.classList.remove('hidden');

            trackEvent('termination_risk_assessed', {
                user: currentUser,
                riskLevel: riskLevel,
                riskScore: riskScore
            });
        }

        function contactConsultantFromRisk() {
            alert('üìû CONNECTING TO SENIOR CONSULTANT\n\nYour termination risk assessment has been sent to our team.\n\nA consultant will call you within 2 hours to discuss your options.\n\nEmail: info@fitzgeraldhr.com.au\nPhone: [Your Number]');
        }

        // ========================================
        // SCENARIO ANALYSIS
        // ========================================
        
        async function analyzeScenario() {
            const venueType = document.getElementById('scenarioVenueType').value;
            const location = document.getElementById('scenarioLocation').value;
            const staffCount = document.getElementById('scenarioStaffCount').value;
            const description = document.getElementById('scenarioDescription').value;

            if (!description) {
                alert('Please describe your situation');
                return;
            }

            document.getElementById('scenarioResults').innerHTML = `
                <div class="bg-slate-900 border border-amber-500 rounded-lg p-6">
                    <div class="flex items-center gap-3 text-amber-400 mb-4">
                        <div class="animate-pulse">‚è≥</div>
                        <span>Analyzing your scenario...</span>
                    </div>
                </div>
            `;
            document.getElementById('scenarioResults').classList.remove('hidden');

            // Build context for Claude
            const scenarioContext = `
CUSTOM SCENARIO ANALYSIS REQUEST:

Venue Type: ${venueType || 'Not specified'}
Location: ${location || 'Not specified'}
Staff Count: ${staffCount || 'Not specified'}

SITUATION:
${description}

Please provide a comprehensive, tailored analysis including:
1. Key issues identified
2. Legal/compliance risks specific to this situation
3. Step-by-step action plan with timeline
4. Specific considerations for this venue type and size
5. Estimated costs or savings if relevant
6. Priority recommendations

Be specific and actionable for THIS particular situation.
            `;

            try {
                const response = await callClaudeAPI(scenarioContext);
                
                document.getElementById('scenarioResults').innerHTML = `
                    <div class="bg-slate-900 border border-green-500 rounded-lg p-6">
                        <h3 class="text-green-500 font-bold text-lg mb-4 flex items-center gap-2">
                            <span>‚úÖ</span>
                            <span>Custom Analysis for Your Situation</span>
                        </h3>
                        <div class="prose prose-invert max-w-none text-slate-200 space-y-3 text-sm">
                            ${response.replace(/\n/g, '<br>')}
                        </div>
                        <button onclick="downloadScenarioAnalysis()" 
                                class="w-full mt-4 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-2 rounded-lg transition-all">
                            üìÑ Download Action Plan
                        </button>
                    </div>
                `;

                trackEvent('scenario_analyzed', { user: currentUser, venueType, staffCount });
            } catch (error) {
                document.getElementById('scenarioResults').innerHTML = `
                    <div class="bg-red-500/10 border border-red-500 rounded-lg p-6 text-center">
                        <p class="text-red-400">Error analyzing scenario. Please try again.</p>
                    </div>
                `;
            }
        }

        function downloadScenarioAnalysis() {
            const analysis = document.querySelector('#scenarioResults .prose').innerHTML;
            generateWordDocument(
                `<h1>Custom HR Scenario Analysis</h1>${analysis}`,
                `Scenario_Analysis_${Date.now()}.doc`,
                { type: 'scenario-analysis', user: currentUser }
            );
        }

        // ========================================
        // XERO INTEGRATION
        // ========================================
        
        function connectXero() {
            // In production, this would initiate OAuth2 flow
            alert('üîó XERO INTEGRATION\n\nThis feature connects to Xero via secure OAuth 2.0.\n\nFor beta testing:\n‚Ä¢ This simulates a connection\n‚Ä¢ Real integration requires API credentials\n‚Ä¢ Contact info@fitzgeraldhr.com.au to enable\n\nProduction features:\n‚úì Auto-sync payroll data\n‚úì Real-time cost analysis\n‚úì Compliance monitoring\n‚úì Overtime alerts');

            // Simulate connection
            document.getElementById('xeroNotConnected').classList.add('hidden');
            document.getElementById('xeroConnected').classList.remove('hidden');
            
            document.getElementById('xeroAnalysis').innerHTML = `
                <div class="bg-slate-900 border border-green-500 rounded-lg p-4">
                    <h4 class="text-green-400 font-bold mb-3">Last 30 Days Analysis:</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between py-2 border-b border-slate-700">
                            <span class="text-slate-300">Total Labor Cost:</span>
                            <span class="font-bold text-white">$18,473</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-slate-700">
                            <span class="text-slate-300">Overtime Hours:</span>
                            <span class="font-bold text-yellow-400">47 hrs (‚Üë23%)</span>
                        </div>
                        <div class="flex justify-between py-2 border-b border-slate-700">
                            <span class="text-slate-300">Sunday Penalties:</span>
                            <span class="font-bold text-white">$2,341</span>
                        </div>
                        <div class="flex justify-between py-2">
                            <span class="text-slate-300">Compliance Issues:</span>
                            <span class="font-bold text-red-400">2 detected</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-yellow-500/10 border border-yellow-500 rounded-lg p-4">
                    <p class="text-yellow-400 font-bold mb-2">‚ö†Ô∏è Alerts:</p>
                    <ul class="text-sm text-slate-300 space-y-1">
                        <li>‚Ä¢ Employee worked 7 consecutive days (compliance risk)</li>
                        <li>‚Ä¢ Overtime increased 23% vs last month (investigate)</li>
                    </ul>
                </div>
            `;

            trackEvent('xero_connected', { user: currentUser });
        }

        // Close tools menu when clicking outside
        document.addEventListener('click', function(event) {
            const toolsMenu = document.getElementById('toolsMenu');
            const toolsButton = event.target.closest('button');
            
            if (toolsMenu && !toolsMenu.contains(event.target) && (!toolsButton || !toolsButton.onclick?.toString().includes('toggleToolsMenu'))) {
                toolsMenu.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
